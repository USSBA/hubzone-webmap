// legend utilties
HZApp.Legend = (function(){
  return {
    legend: HZApp.Legend.LegendDefs.legend,
    buildLegend: function(){
      this.addLegendButtonListeners();
      this.setMobileState(window.innerWidth);
      this.addLayerToggleListeners();
    },
    addLegendButtonListeners: function(){
      $('.legend-header').click(function(event) {
        HZApp.Legend.toggleLegendVisibility(event.currentTarget.className);
      });
    },
    toggleLegendVisibility: function(legendState) {
        if(legendState.indexOf('open', 0) !== -1) {
          HZApp.Legend.hideLegend();
        } else {
          HZApp.Legend.showLegend();
        }
    },
    hideLegend: function(){
      $('.legend-item').hide();
      $('.legend-button').addClass("fa-chevron-up").removeClass("fa-chevron-down");
      $('.legend-content').hide();
      $('.legend-header').removeClass('open');
    },
    showLegend: function(){
      $('.legend-item').show();
      $('.legend-button').addClass("fa-chevron-down").removeClass("fa-chevron-up");
      $('.legend-content').show();
      $('.legend-header').addClass('open');
    },
    setMobileState: function(windowWidth) {
      if (windowWidth < 950) {
        HZApp.Legend.hideLegend();
      }
    },

    addLayerToggleListeners: function() {
      HZApp.Legend.setLayerGroups('us_county', HZApp.Layers.LayerDefs.hzWMSOverlays);
      HZApp.Legend.setLayerGroups('us_tract', HZApp.Layers.LayerDefs.hzWMSOverlays);
      HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(0);
      HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = false;

      HZApp.Legend.setLayerGroups('qnmc_new', HZApp.Layers.LayerDefs.hzWMSOverlays);
      HZApp.Legend.setLayerGroups('qct_new', HZApp.Layers.LayerDefs.hzWMSOverlays);

      function createWmsLayer(filter, style) {
        return new google.maps.ImageMapType({
          getTileUrl: function(coord, zoom){
            return HZApp.WMTSUtils.buildTileUrlFilter(coord, zoom, 'census_state',filter,style);
          },
          tileSize: new google.maps.Size(256, 256),
          isPng: true,
          opacity: 0.9
        })
      };

      $('#mapHighlightState').on("change",function(){
        var stateName = $(this).val().split('_')[1];

        if(HZApp.map.overlayMapTypes.length  > 13){
          HZApp.map.overlayMapTypes.removeAt(14);
          HZApp.map.overlayMapTypes.removeAt(14);
        }
        if(stateName == 'undefined'){
          return
        }
        var replaceSelectedFilterNotEqual = "name <>'"+stateName+"'";
        var replaceSelectedFilterEqual = "name ='"+stateName+"'";
        var newWmsLayerNotEqual = createWmsLayer(replaceSelectedFilterNotEqual, "hubzone_preview:giant_polygon");
        var newWmsLayerEqual = createWmsLayer(replaceSelectedFilterEqual, "hubzone_preview:polygon_without_fill");
       HZApp.map.overlayMapTypes.push(newWmsLayerNotEqual);
       HZApp.map.overlayMapTypes.push(newWmsLayerEqual);


       getBoundingBoxForState(stateName, function (bbox) {
          var southWest = new google.maps.LatLng(bbox[1], bbox[0]);
          var northEast = new google.maps.LatLng(bbox[3], bbox[2]);
          var bounds = new google.maps.LatLngBounds(southWest, northEast);
          HZApp.map.fitBounds(bounds);
      });

      });

      function computeBoundingBox(coordinates) {
        let bounds = new google.maps.LatLngBounds();

        coordinates.forEach(polygon => {
            polygon.forEach(ring => {
                ring.forEach(coord => {
                    bounds.extend(new google.maps.LatLng(coord[1], coord[0]));
                });
            });
        });

        return [
            bounds.getSouthWest().lng(),
            bounds.getSouthWest().lat(),
            bounds.getNorthEast().lng(),
            bounds.getNorthEast().lat()
        ];
      }

      function getBoundingBoxForState(stateName, callback) {
          let url = "<%= MAP_CONFIG[:geom_wms_settings][:url_root_without_gwc] %>";
          let modifiedUrl = url.replace("/wms","/ows")

          var wfsUrl = modifiedUrl+"service=WFS&version=1.0.0&request=GetFeature&typeName=hubzone_preview:census_state&outputFormat=application/json&CQL_FILTER=name='" + stateName + "'";

          fetch(wfsUrl)
              .then((response) => {
                console.log('respose Zooming')
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  return response.json();
              })
              .then((data) => {
                  if (data.features.length > 0) {
                      var bbox = computeBoundingBox(data.features[0].geometry.coordinates);
                      callback(bbox);
                  }
              })
              .catch((error) => {
                  console.error("Failed to fetch bounding box for state:", stateName, error);
              });
      }

      
      $('input[type="checkbox"]').click( function(event){
        
      <% if false %>
        if(event.currentTarget.value =='qct'){

              if(!document.getElementById('qct_legend').checked){
                HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
                HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
                if(!document.getElementById('qnmc_legend').checked){
                  document.getElementById('qnmc_new_legend').checked = false ;
                  HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
                  HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
                  
                }
              }else if(document.getElementById('qct_legend').checked && document.getElementById('qnmc_new_legend').checked){
                HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
                HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
              }
             
            if(document.getElementById('qct_legend').checked && document.getElementById('redesignated_legend').checked){
              
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = false;

              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = true;

            }else if(document.getElementById('redesignated_legend').checked){

              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = true;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = false;

            }else if (!document.getElementById('qct_legend').checked && !document.getElementById('redesignated_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = false;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = false;
              HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].isVisible = false;
            }
        }

        <% end %>

      <% if false %> 
      if(event.currentTarget.value =='qnmc' || event.currentTarget.value =='qct' ){
        if(!document.getElementById('qct_legend').checked){
          if(!document.getElementById('qnmc_legend').checked){
           
            
            if(document.getElementById('qnmc_new_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = true;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
            }else if(!document.getElementById('qnmc_new_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
            }
         

            if(document.getElementById('newly_qnmc_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = true;
            }else if(!document.getElementById('newly_qnmc_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
            }
            if(document.getElementById('newly_qct_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
            }else if(!document.getElementById('newly_qct_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
          
            }
            
          } else if(document.getElementById('qnmc_legend').checked){

       
          if(document.getElementById('qnmc_new_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = true;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
            }else if(!document.getElementById('qnmc_new_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
            }
            

            if(document.getElementById('newly_qnmc_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = true;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
            }else if(!document.getElementById('newly_qnmc_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
            }
            if(document.getElementById('newly_qct_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
            }else if(!document.getElementById('newly_qct_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
          
            }

          }
        }else if(document.getElementById('qct_legend').checked){
          if(!document.getElementById('qnmc_legend').checked){
           
        
            if(document.getElementById('qnmc_new_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
            }else if(!document.getElementById('qnmc_new_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
            }
           

            if(document.getElementById('newly_qnmc_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
            }else if(!document.getElementById('newly_qnmc_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
            }
            if(document.getElementById('newly_qct_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
            }else if(!document.getElementById('newly_qct_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
            }
          } else if(document.getElementById('qnmc_legend').checked){

         
            if(document.getElementById('qnmc_new_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = true;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
            }else if(!document.getElementById('qnmc_new_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
            }
        

            if(document.getElementById('newly_qnmc_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = true;
            }else if(!document.getElementById('newly_qnmc_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
            }
            if(document.getElementById('newly_qct_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
            }else if(!document.getElementById('newly_qct_legend').checked){
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
              HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
            }

            
          }
        }
        HZApp.Legend.setLayerGroups(event.currentTarget.value, HZApp.Layers.LayerDefs.hzWMSOverlays);

      }else
      <% end %>

      if(event.currentTarget.value =='qct' || event.currentTarget.value =='qnmc'){

        if(!document.getElementById('qct_legend').checked && !document.getElementById('qnmc_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
          document.getElementById('newly_qct_legend').checked = true
          HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = true;
          document.getElementById('newly_qnmc_legend').checked = true
        }else if(!document.getElementById('qnmc_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
          document.getElementById('newly_qnmc_legend').checked = false
        }else if(!document.getElementById('qct_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
          document.getElementById('newly_qct_legend').checked = false
        }

        HZApp.Legend.setLayerGroups(event.currentTarget.value, HZApp.Layers.LayerDefs.hzWMSOverlays);

      }else if(event.currentTarget.value =='redesignated'){

        if(document.getElementById('redesignated_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].overlay.setOpacity(1);
            HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].isVisible = true;

            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(0);
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = false;

            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(1);
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = true;
        }

        if(!document.getElementById('redesignated_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].overlay.setOpacity(0);
            HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].isVisible = false;

            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(1);
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = true;

            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(0);
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = false;
        }


        <% if false %>
          if(document.getElementById('qct_legend').checked && document.getElementById('redesignated_legend').checked){
              
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(0);
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = false;

            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(1);
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = true;

            HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].overlay.setOpacity(1);
            HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].isVisible = true;
          

          }
          if(document.getElementById('redesignated_legend').checked && !document.getElementById('qct_legend').checked ){

            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(1);
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = true;

            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(0);
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = false;

            HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].overlay.setOpacity(1);
            HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].isVisible = true;

          }

         if(!document.getElementById('qct_legend').checked && !document.getElementById('redesignated_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = false;
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = false;
          HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].isVisible = false;
        }

        if(!document.getElementById('redesignated_legend').checked && document.getElementById('qct_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_extras'].isVisible = false;
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_r_slivers'].isVisible = false;
          HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['redesignated_lg'].isVisible = false;
        }
        <% end %>
        

      }else if(event.currentTarget.value =='newly_qct_legend' || event.currentTarget.value =='newly_qnmc_legend'){
        if(document.getElementById('newly_qnmc_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = true;
        }else if(!document.getElementById('newly_qnmc_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible = false;
        }
        if(document.getElementById('newly_qct_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = true;
        }else if(!document.getElementById('newly_qct_legend').checked){
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(0);
          HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible = false;
        }
      }else{
        HZApp.Legend.setLayerGroups(event.currentTarget.value, HZApp.Layers.LayerDefs.hzWMSOverlays);
      }

      console.log('legend');

        if(document.getElementById('newly_qnmc_legend').checked || document.getElementById('newly_qct_legend').checked){
          Object.keys(HZApp.Layers.LayerDefs.hzWMSOverlays).map(function(layer) {
            if(HZApp.Layers.LayerDefs.hzWMSOverlays[layer].isVisible){
                HZApp.Layers.LayerDefs.hzWMSOverlays[layer].overlay.setOpacity(0.3);
            }
          });
          if(HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].isVisible){
            HZApp.Layers.LayerDefs.hzWMSOverlays['qct_new'].overlay.setOpacity(1);
          }
          if(HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].isVisible){
            HZApp.Layers.LayerDefs.hzWMSOverlays['qnmc_new'].overlay.setOpacity(1);
          }
        }else{
          Object.keys(HZApp.Layers.LayerDefs.hzWMSOverlays).map(function(layer) {
            if(HZApp.Layers.LayerDefs.hzWMSOverlays[layer].isVisible){
              HZApp.Layers.LayerDefs.hzWMSOverlays[layer].overlay.setOpacity(1);
            }
          })
        }

        
      });
    },

    setLayerGroups: function(selectedLayer, wmsOverlays) {
      Object.keys(wmsOverlays).map(function(layer) {
        if(wmsOverlays[layer].layerGroup === selectedLayer){
          HZApp.Legend.toggleLayerGroup(wmsOverlays[layer]);
        } else {

        }
      });
    },
    toggleLayerGroup: function(layer) {
      if(layer.isVisible){
        layer.overlay.setOpacity(0);
        layer.isVisible = false;
      } else {
        layer.overlay.setOpacity(1);
        layer.isVisible = true;
      }
    }
  };
})();
