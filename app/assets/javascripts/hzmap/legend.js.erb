// legend utilties
HZApp.Legend = (function(){
  return {
    legend: HZApp.Legend.LegendDefs.legend,
    buildLegend: function(layers){
      this.addLegendButtonListeners();
      this.setLegendState(window.innerWidth);
      this.addLayerToggleListeners();
    },
    addLegendButtonListeners: function(){
      $('.legend-header').click(function(event) {
        HZApp.Legend.toggleLegendVisibility(event.currentTarget.className);
      });
    },
    toggleLegendVisibility: function(legendState) {
        if(legendState.includes('open')) {
          HZApp.Legend.hideLegend();
          $('.legend-header').removeClass('open');
        } else {
          HZApp.Legend.showLegend();
          $('.legend-header').addClass('open');
        }
    },
    hideLegend: function(){
      $('#legend .legend-item').hide();
      $('.legend-button').toggleClass("fa-chevron-down fa-chevron-up")
      $('#legend-header-title-expanded').hide();
      $('.legend-header-title').show();
    },
    showLegend: function(){
      $('#legend .legend-item').show();
      $('.legend-button').toggleClass("fa-chevron-up fa-chevron-down")
      $('#legend-header-title-expanded').show();
      $('.legend-header-title').hide();
    },
    setLegendState: function(windowWidth) {
      if (windowWidth > 950) {
        HZApp.Legend.toggleLegendVisibility('');
      } else {
        HZApp.Legend.toggleLegendVisibility('open');
      }
    },
    addLayerToggleListeners: function() {
      $('input[type="checkbox"]').click( function(event){
        HZApp.Legend.setLayerGroups(event.currentTarget.value, HZApp.Layers.LayerDefs.hzWMSOverlays);
      });
    },
    setLayerGroups: function(selectedLayer, wmsOverlays) {
      Object.keys(wmsOverlays).map(function(layer) {
        if(wmsOverlays[layer].layerGroup === selectedLayer){
          HZApp.Legend.toggleLayerGroup(wmsOverlays[layer]);
        } else {
        }
      });
    },
    toggleLayerGroup: function(layer) {
      if(layer.isVisible){
        layer.overlay.setOpacity(0);
        layer.isVisible = false;
      } else {
        layer.overlay.setOpacity(1);
        layer.isVisible = true;
      }
    }
  };
})();
