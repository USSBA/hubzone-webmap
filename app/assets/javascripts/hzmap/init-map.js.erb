//create the map on load, when idle, jump to updateMap to get features
/* exported initMap */
function initMap() {

  HZApp.map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 39.8282, lng: -98.5795},
    zoom: 5,
    zoomControl: true,
    zoomControlOptions: {
      position: google.maps.ControlPosition.RIGHT_BOTTOM
    },
    streetViewControlOptions: {
      position: google.maps.ControlPosition.RIGHT_BOTTOM
    },
    mapTypeControlOptions: {
      mapTypeIds: ['roadmap', 'hz_map', 'hybrid' ],
      position: google.maps.ControlPosition.BOTTOM_CENTER
    },
  });

  //adds in the hz style into the basemap picker
  var hzStyledMap = new google.maps.StyledMapType(hzBaseMapStyle, {name: 'Gray'});
  HZApp.map.mapTypes.set('hz_map', hzStyledMap);
  HZApp.map.setMapTypeId('roadmap', {name: 'Wow'});

  //adds the map legend and geolocation button
  HZApp.map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(document.getElementById('legend'));
  HZApp.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(document.getElementById('geolocation'));

  // adds listener that triggers whenever the map is idle to update with new features.
  google.maps.event.addListener(HZApp.map, 'idle', updateIdleMap);
  HZApp.map.addListener('click', catchMapClick);

  //adds autocomplete
  var searchInput = document.getElementById('search-field-small');
  var options = {
    types: ['geocode']
  };
  /* jshint unused: false */
  var autocomplete = new google.maps.places.Autocomplete(searchInput, options);

  // build out the markers
  /* jshint ignore:start */
  HZApp.markers.hzQueryMarker = new HubzoneMapMarker({
    icon: '<%= image_path 'hubzone-map-marker.svg' %>'
  });
  HZApp.markers.hzUserLocation = new HubzoneMapMarker({
    icon: '<%= image_path 'geolocation-marker.svg' %>'
  });
  /* jshint ignore:end */

  //initialize user location
  HZApp.GeoLocation.getUserLocation(navigator.geolocation);

  //returns the map
  return HZApp.map;
}
