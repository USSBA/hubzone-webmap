<%
  # expecting body to be a hash that has either a message or a formatted_address and hubzones from hzutil search
  if body
    address = body['formatted_address'].nil? ? t(body['message']) : body['formatted_address']
    if !body['address_components'].nil?
      coordinates = [format('%.5f', body['geometry']['location']['lat']) + "\xC2\xB0", format('%.5f', body['geometry']['location']['lng']) + "\xC2\xB0"].join(', ')
    else
      coordinates = nil
    end
    date = if body['query_date'].present?
             date = Date.parse(body['query_date'])
             date = I18n.l date, format: :full
           else
             body['query_date']
           end
    if body['formatted_address'].nil?
      visibility = 'hidden'
      details_visibility = 'hidden'
      hubzone_status_indicator = 'fa fa-times-circle-o'
      hubzone_status_style = 'qualified-hubzone'
    elsif body['hubzone'].size > 0
      visibility = ''
      hubzone_status_indicator = 'fa fa-check-circle-o qualified-hubzone'
      hubzone_status_style = 'qualified-hubzone'
      hubzone_status = t('hubzone_assertions.qualified')
      aria_hubzone_status = t('hubzone_assertions.qualified_aria')
      hubzones = body['hubzone']
    else
      visibility = ''
      details_visibility = 'hidden'
      hubzone_status_style = 'non-qualified-hubzone'
      hubzone_status_indicator ='fa fa-times-circle-o non-qualified-hubzone'
      hubzone_status = t('hubzone_assertions.not_qualified')
      aria_hubzone_status = t('hubzone_assertions.not_qualified_aria')
    end
  end
%>

<div class="sidebar-card search-result">
  <div class="hubzone-sidebar-cell marker">
    <i class="fa fa-map-marker" aria-hidden="true"></i>
  </div>
  <div class="hubzone-sidebar-cell text">
    <div class="hubzone-sidebar-row">
      <h2 class="hubzone-sidebar-address" tabindex="10"><%= address %></h2>
    </div>
    <% if coordinates %>
      <div class="hubzone-sidebar-row">
        <h4 class="hubzone-sidebar-coordinates"><%= coordinates %></h4>
      </div>
    <% end %>
  </div>
</div>

<div class="sidebar-card hubzone-status <%= hubzone_status_style %> <%= visibility %>">
  <table id="hubzone-qualifications" class="sidebar-qualifications">
    <thead>
      <th class="<%= hubzone_status_style %>" scope="row">
        <div class="hubzone-status-indicator ">
          <i class="<%= hubzone_status_indicator %>" aria-hidden="true"></i>
        </div>
        <div id="hubzone-status" tabindex="11" aria-label="<%= aria_hubzone_status %>"><%= hubzone_status %></div>
      </th>
    </thead>
  </table>
</div>

<div class="sidebar-card additional-details <%= details_visibility %>">
   <table class="sidebar-qualifications">
     <thead>
       <th class="additional-details-title" scope="row">
       Additional Details
     </th>
     </thead>
     <tbody>
       <%= render partial: "qualification", collection: hubzones %>
     </tbody>
   </table>
 </ul>
</div>

<div class="sidebar-card map-actions">
  <button id="map-report" tabindex="15">
    <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
    <div class="create-report">Create Report</div>
  </button>
  <span id="report-waiting"></span>
</div>

<div class="sidebar-card hubzone-status-date <%= visibility %>" tabindex="12">
  <%= t('hubzone_assertions.qualifications_effective') %><%= date %>
</div>
